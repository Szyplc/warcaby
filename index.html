<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<title>Warcaby</title>
</head>
<body>
    <style>
        table, tr, td
        {
            border: 2px solid black;
            border-collapse: collapse;
        }
        tr, td
        {
            width: 40px;
            height: 40px;
        }
        .white
        {
            background-color: white;
            color: black;
            text-align: center;
            font-weight: 700;
        }
        .black
        {
            background-color: black;
            color: white;
            text-align: center;
            font-weight: 700;
        }
        .turn
        {
            background-color: #000000;
            color: white;
            text-align: center;
            display: inline;
            position: absolute;
            font-size: 50px;
        }
        table
        {
            display: inline;
        }
        .Clicked
        {
            text-align: center;
            background-color: darkmagenta;
        }
    </style>
   <script>
        var wcb = "";
        var board = [[], [], [], [], [], [], [], []];
        var turn = 0;
        var table = document.createElement("table");
        var pTurn = document.createElement("p");
        var piecePosition = ['17', '37', '57', '77', '06', '26', '46', '66'];
        var blackPiecePosition = ['00', '20', '40', '60', '11', '31', '51', '71'];
        var style = "background: #00ff00;";
        Start();
        function Start()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    board[i].push("");
                }
            }
            for(let i=0;i<8;i++)
            {
                var tr = document.createElement("tr");
                for(let o=0;o<8;o++)
                {
                    var td = document.createElement("td");
                    id = o + "" + i;
                    td.setAttribute("id", id);
                    if((o+i) % 2 == 1)
                        td.setAttribute("class", "black");
                    else
                        td.setAttribute("class", "white");
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            document.body.appendChild(table);
            pTurn.id = "turn";
            pTurn.setAttribute("class", "turn");
            document.body.append(pTurn);
            setInterval(UpdateTurn, 500);
            piecePosition.forEach(function a(item, index)
            {
                var i1 = parseInt(item[0]);
                var i2 = parseInt(item[1]);
                board[i1][i2] = "O";
            })
            blackPiecePosition.forEach(function b(item, index)
            {
                var z1 = parseInt(item[0]);
                var z2 = parseInt(item[1]);
                board[z1][z2] = "X";
            })
            MakeBoard();
            document.addEventListener('click', OnClick);
        }
        function OnClick(e)
        {
            RemoveStyle();
            if(e.srcElement.id == '' || e.srcElement.id == "turn")
            {
                return 0;
            }
            var i1 = e.srcElement.id[0];
            var i2 = e.srcElement.id[1];
            // to ma isclicked jak nie to usun wszystkie is clicked
            if(e.srcElement.hasAttribute('isClicked'))
            {
                OnClickIsClicked(e.srcElement.id);
                LastRow();
                MakeBoard();
                RemoveIsClicked();
                RemoveStyle();
                turn++;
                return 0;
            }
            FirstClick(i1, i2, e.srcElement.id);
            e.srcElement.classList.add("Clicked");
        }
        function FirstClick(i1, i2, id)
        {

            var field = document.getElementById(id);
            if((field.textContent == "o" || field.textContent == "O") && turn % 2 == 0)
            {
                if(IsSomewhereKickedOf("o") != "" || IsSomewhereKickedOf("O") != "")
                {
                    return "";
                }
            }
            else if((field.textContent == "x" || field.textContent == "X") && turn % 2 == 1)
            {
                if(IsSomewhereKickedOf("x") != "" || IsSomewhereKickedOf("X") != "")
                {
                    return "";
                }
            }
            if(board[i1][i2] == "O" && turn % 2 == 0)
            {//zmienia tez i1 i i2 jak przy klasach
                if(i2 < 1)
                {
                    return 0;
                }
                var l1 = parseInt(i1) - 1;
                var l2 = parseInt(i2) - 1;
                var r1 = parseInt(i1) + 1;
                var r2 = parseInt(i2) - 1;
                if(i1>0)//left
                {
                    
                    var left = "" + l1 + l2;
                    if(!document.getElementById(left).hasAttribute('style'))//usunac to raczej
                    {
                          RemoveStyle();
                        var z1 = left[0];
                        var z2 = left[1];//dac pierww kick off
                        if(board[z1][z2] == "X" || board[z1][z2] == "x")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "O") || IsKickOff(i1. i2, "o"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "O")
                        {
                            if(IsSomewhereKickedOf("O") == "" || IsSomewhereKickedOf("o") == "")
                            {
                                document.getElementById(left).setAttribute("style", style);
                                document.getElementById(left).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }   
                        
                        
                    }
                }
                if(i1<7)//right
                {

                    var right = "" + r1 + r2;
                    if(!document.getElementById(right).hasAttribute('style'))
                    {
                        var z1 = right[0];
                        var z2 = right[1];
                        if(board[z1][z2] == "X" || board[z1][z2] == "x")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "O") || IsKickOff(i1, i2, "o"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "O")//tu pozniej bez X bo bicie
                        {
                            if(IsSomewhereKickedOf("O") == "" || IsSomewhereKickedOf("o") == "")
                            {
                                document.getElementById(right).setAttribute("style", style);
                                document.getElementById(right).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }
                    }
                }
            }
            else
            if(board[i1][i2] == "X" && turn % 2 == 1)//zmienic i2 <1 itp
            {//zmienia tez i1 i i2 jak przy klasach
                if(i2 > 6)
                {
                    return 0;
                }
                var l1 = parseInt(i1) - 1;
                var l2 = parseInt(i2) + 1;
                var r1 = parseInt(i1) + 1;
                var r2 = parseInt(i2) + 1;
                if(i1>0)//left
                {
                    
                    var left = "" + l1 + l2;
                    if(!document.getElementById(left).hasAttribute('style'))//usunac to raczej
                    {
                          RemoveStyle();
                        var z1 = left[0];
                        var z2 = left[1];//dac pierww kick off
                        if(board[z1][z2] == "O" || board[z1][z2] == "o")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "X") || IsKickOff(i1, i2, "x"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "X")//tu pozniej bez X bo bicie 
                        {
                            if(IsSomewhereKickedOf("X") == "" || IsSomewhereKickedOf("x") == "")
                            {
                                document.getElementById(left).setAttribute("style", style);
                                document.getElementById(left).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }   
                        
                        
                    }
                }
                if(i1<7)//right
                {

                    var right = "" + r1 + r2;
                    if(!document.getElementById(right).hasAttribute('style'))
                    {
                        var z1 = right[0];
                        var z2 = right[1];
                        if(board[z1][z2] == "O" || board[z1][z2] == "o")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "X") || IsKickOff(i1, i2, "x"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "X")//tu pozniej bez X bo bicie
                        {
                            if(IsSomewhereKickedOf("X") == "" || IsSomewhereKickedOf("x") == "")
                            {
                                document.getElementById(right).setAttribute("style", style);
                                document.getElementById(right).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }
                    }
                }
            }
            else if(board[i1][i2] == "o" && turn % 2 == 0)
            {
                let lx = parseInt(i1) - 1;
                let ly = parseInt(i2) - 1;
                while(lx >= 0 && ly >= 0)
                {
                    let position = "" + lx + ly;
                    if(board[lx][ly] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[lx][ly] == "x" || board[lx][ly] == "X")
                    {
                        if(lx-1 >= 0 && ly-1 >= 0)
                            if(board[lx-1][ly-1] != "")
                                break;
                    }
                    else break;
                    lx--;
                    ly--;
                }
                // to right
                let rx = parseInt(i1) + 1;
                let ry = parseInt(i2) - 1;
                while(rx < 8 && ry >= 0)
                {
                    let position = "" + rx + ry;
                    if(board[rx][ry] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[rx][ry] == "x" || board[rx][ry] == "X")
                    {
                        if(rx+1 < 8 && ry-1 >= 0)
                            if(board[rx+1][ry-1] != "")
                                break;
                    }
                    else break;
                    rx++;
                    ry--;
                }
                //To left
                lx = parseInt(i1) - 1;
                ly = parseInt(i2) + 1;
                while(lx >= 0 && ly < 8)
                {
                    let position = "" + lx + ly;
                    if(board[lx][ly] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[lx][ly] == "x" || board[lx][ly] == "X")
                    {
                        if(lx-1 >= 0 && ly+1 < 8)
                            if(board[lx-1][ly+1] != "")
                                break;
                    }
                    else break;
                    lx--;
                    ly++;
                }
                //To right
                rx = parseInt(i1) + 1;
                ry = parseInt(i2) + 1;
                while(rx < 8 && ry < 8)
                {
                    let position = "" + rx + ry;
                    if(board[rx][ry] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[rx][ry] == "x" || board[rx][ry] == "X")
                    {
                        if(rx+1 < 8 && ry+1 < 8)
                            if(board[rx+1][ry+1] != "")
                                break;
                    }
                    else break;
                    rx++;
                    ry++;
                }
            }
            else if(board[i1][i2] == "x" && turn % 2 == 1)
            {
                //To left
                let lx = parseInt(i1) - 1;
                let ly = parseInt(i2) - 1;
                while(lx >= 0 && ly >= 0)
                {
                    let position = "" + lx + ly;
                    if(board[lx][ly] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[lx][ly] == "o" || board[lx][ly] == "O")
                    {
                        if(lx-1 >= 0 && ly-1 >= 0)
                            if(board[lx-1][ly-1] != "")
                                break;
                    }
                    else break;
                    lx--;
                    ly--;
                }
                // to right
                let rx = parseInt(i1) + 1;
                let ry = parseInt(i2) - 1;
                while(rx < 8 && ry >= 0)
                {
                    let position = "" + rx + ry;
                    if(board[rx][ry] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[rx][ry] == "o" || board[rx][ry] == "O")
                    {
                        if(rx+1 < 8 && ry-1 >= 0)
                            if(board[rx+1][ry-1] != "")
                                break;
                    }
                    else break;
                    rx++;
                    ry--;
                }
                
                lx = parseInt(i1) - 1;
                ly = parseInt(i2) + 1;
                while(lx >= 0 && ly < 8)
                {
                    let position = "" + lx + ly;
                    if(board[lx][ly] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[lx][ly] == "o" || board[lx][ly] == "O")
                    {
                        if(lx-1 >= 0 && ly+1 < 8)
                            if(board[lx-1][ly+1] != "")
                                break;
                    }
                    else break;
                    lx--;
                    ly++;
                }
                //To right
                rx = parseInt(i1) + 1;
                ry = parseInt(i2) + 1;
                while(rx < 8 && ry < 8)
                {
                    let position = "" + rx + ry;
                    if(board[rx][ry] == "")
                    {
                        document.getElementById(position).setAttribute("IsClicked", field.id);
                        document.getElementById(position).setAttribute("style", style);
                    }
                    else if(board[rx][ry] == "o" || board[rx][ry] == "O")
                    {
                        if(rx+1 < 8 && ry+1 < 8)
                            if(board[rx+1][ry+1] != "")
                                break;
                    }
                    else break;
                    rx++;
                    ry++;
                }
            }
        }
        function OnClickIsClicked(id)
        {
            var field = document.getElementById(id);
            if(wcb != "")
                {
                    if(field.getAttribute("isClicked") != wcb)
                    {
                        alert("MASZ BICIE!!!");
                        return 0;
                    }
                }
                wcb = "";
                var id = field.id;
                var position = "" + document.getElementById(id).getAttribute('isClicked');
                //var position = e.srcElement.getAttribute('isClicked');//stad zabrac piona
                var d1 = field.id[0];
                var d2 = field.id[1]; 
                var n1 = position[0];
                var n2 = position[1];
                if(board[n1][n2] == "O")
                {
                    board[d1][d2] = "O";
                    board[n1][n2] = "";
                    var b1 = (parseInt(d1) + parseInt(n1)) / 2;
                    var b2 = (parseInt(d2) + parseInt(n2)) / 2;
                    if(b1 % 1 ==0 && b2 % 1 == 0)
                    {
                        if(board[b1][b2] == "X" || board[b1][b2] == "x")
                        {
                            board[b1][b2] = "";
                            if(IsKickOff(d1, d2, "O"))
                            {
                                wcb = "" + d1 + d2;
                                turn--;
                            }
                        }
                    }
                }
                else if(board[n1][n2] == "X")
                {
                    board[d1][d2] = "X";
                    board[n1][n2] = "";
                    var b1 = (parseInt(d1) + parseInt(n1)) / 2;
                    var b2 = (parseInt(d2) + parseInt(n2)) / 2;
                    if(b1 % 1 ==0 && b2 % 1 == 0)
                    {
                        if(board[b1][b2] == "O" || board[b1][b2] == "o")
                        {
                            board[b1][b2] = "";
                            if(IsKickOff(d1, d2, "X"))
                            {
                                wcb = "" + d1 + d2;
                                turn--;
                            }
                        }
                    }
                }
                else if(board[n1][n2] == "o" || board[n1][n2] == "x")
                {
                    //ogarnac dwa przypadki gdy sa o lub x
                    //let position = document.getElementById("" + n1 + n2).getAttribute("isClicked");
                    //let x = position[0];
                    //let y = position[1];
                    var color = board[n1][n2];
                    if(board[n1][n2] == "o")
                        board[d1][d2] = "o";
                    else
                        board[d1][d2] = "x";
                    board[n1][n2] = "";
                    var np = GoCloser(n1, n2, d1, d2);
                    n1 = np[0];
                    n2 = np[1];
                    while(n1 != d1)
                    {
                        if(board[n1][n2] != "")
                        {
                            board[n1][n2] = "";
                            if(IsKickOff(n1, n2, color))
                                turn--;
                        }
                        let np = GoCloser(n1, n2, d1, d2);
                        n1 = np[0];
                        n2 = np[1];
                    }
                    
                }                
        }
        function GoCloser(x1, y1, x2, y2)
        {
            if(x1 < x2)
                x1++;
            else
                x1--;
            if(y1 < y2)
                y1++;
            else
                y1--;
            var position = "" + x1 + y1;
            return position;
        }
        function IsSomewhereKickedOf(c)
        {
            var position = "";
            //RemoveStyle();
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    if(board[o][i] == c)
                    {
                        if(IsKickOff(o, i, c))
                        {
                            var position = "" + o + i;
                            //return position;
                        }
                    }
                }
            }
            return position;
        }
        function RemoveIsClicked()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    var position = "" + o + i;
                    document.getElementById(position).removeAttribute('isClicked');
                }
            }
        }
        function RemoveStyle()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    var position = "" + o + i;
                    document.getElementById(position).removeAttribute('style');
                    document.getElementById(position).classList.remove('Clicked');
                }
            }
        }
        function MakeBoard()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    let position = "" + o + i;
                    if(board[o][i] == "O")
                    {
                        document.getElementById(position).textContent = "O";
                    }
                    else if(board[o][i] == "X")
                    {
                        document.getElementById(position).textContent = "X";
                    }
                    else if(board[o][i] == "o")
                    {
                        document.getElementById(position).textContent = "o";
                    }
                    else if(board[o][i] == "x")
                    {
                        document.getElementById(position).textContent = "x";
                    }
                    else
                    {
                        document.getElementById(position).textContent = "";
                    }
                }
            }
        }//moze blad jak 2 razy na to samo pole klikniesz bo usuwa is clicked
        function IsKickOff(z1, z2, c)
        {//gdy jestesmy 2 2 to nie mozna nic zroobic bo raczej jest ustawion eze tam nic nie mozna zrobic
           //w lewo przy prawym biciu
           
           var p = "" + z1 + z2;
            if(c == "O")
            {
                var r = false;
                var l1 = parseInt(z1) - 1;
                var l2 = parseInt(z2) - 1;
                var r1 = parseInt(z1) + 1;
                var r2 = parseInt(z2) - 1;
                if(z1 > 1)//lewo
                {
                    if(z2 > 1)
                    {
                       
                        //zabezpieczenia przed koncem planszy
                        if(board[l1][l2] == "X" || board[l1][l2] == "x")
                        {
                            var b1 = l1 - 1;
                            var b2 = l2 - 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
                //powinno wykasowac te ktore sa na mniejszej posycji od maksa zeby bic do konca
                if(z1 < 6)
                {
                    if(z2 > 1)
                    {
                        if(board[r1][r2] == "X" || board[r1][r2] == "x")
                        {
                            var b1 = r1 + 1;
                            var b2 = r2 - 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
            }
            else if(c == "X")
            {
                var r = false;
                var p = "" + z1 + z2;
                var l1 = parseInt(z1) - 1;
                var l2 = parseInt(z2) + 1;
                var r1 = parseInt(z1) + 1;
                var r2 = parseInt(z2) + 1;
                if(z1 > 1)//lewo
                {
                    if(z2 < 6)
                    {
                       
                        //zabezpieczenia przed koncem planszy
                        if(board[l1][l2] == "O" || board[l1][l2] == "o")
                        {
                            var b1 = l1 - 1;
                            var b2 = l2 + 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
                //powinno wykasowac te ktore sa na mniejszej posycji od maksa zeby bic do konca
                if(z1 < 6)
                {
                    if(z2 < 6)
                    {
                        if(board[r1][r2] == "O" || board[r1][r2] == "o")
                        {
                            var b1 = r1 + 1;
                            var b2 = r2 + 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
            }
            else if(c == "o")
            {
                let ec = "X";
                let eck = "x";
                //lewo góra
                let lgx = z1;
                let lgy = z2;
                while(lgx >= 0 && lgy >= 0)
                {
                    if(board[lgx][lgy] == ec || board[lgx][lgy] == eck)
                    {
                        if(lgx - 1 >= 0 && lgy - 1 >= 0)
                        if(board[lgx - 1][lgy - 1] == "")
                        {
                            while(lgx >= 0 && lgy >= 0)
                            {
                                var position = "" + lgx + lgy;
                                if(board[lgx][lgy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                lgx--;
                                lgy--;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    lgx--;
                    lgy--;
                }
                //lewo dół
                let ldx = z1;
                let ldy = z2;
                while(ldx >= 0 && ldy < 8)
                {
                    if(board[ldx][ldy] == ec || board[ldx][ldy] == eck)
                    {
                        if(ldx - 1 >= 0 && ldy + 1 < 8)
                        if(board[ldx - 1][ldy + 1] == "")
                        {
                            while(ldx >= 0 && ldy < 8)
                            {
                                var position = "" + ldx + ldy;
                                if(board[ldx][ldy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                ldx--;
                                ldy++;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    ldx--;
                    ldy++;
                }
                //prawo góra                
                let rgx = z1;
                let rgy = z2;
                while(rgx < 8 && rgy >= 0)
                {
                    if(board[rgx][rgy] == ec || board[rgx][rgy] == eck)
                    {
                        if(rgx + 1 < 8 && rgy - 1 >= 0)
                        if(board[rgx + 1][rgy - 1] == "")
                        {
                            while(rgx < 8 && rgy >= 0)
                            {
                                var position = "" + rgx + rgy;
                                if(board[rgx][rgy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                rgx++;
                                rgy--;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    rgx++;
                    rgy--;
                }
                //prawo dół                
                let rdx = z1;
                let rdy = z2;
                while(rdx < 8 && rdy < 8)
                {
                    if(board[rdx][rdy] == ec || board[rdx][rdy] == eck)
                    {
                        if(rdx + 1 < 8 && rdy + 1 < 8)
                        if(board[rdx + 1][rdy + 1] == "")
                        {
                            while(rdx < 8 && rdy < 8)
                            {
                                var position = "" + rdx + rdy;
                                if(board[rdx][rdy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                rdx++;
                                rdy++;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    rdx++;
                    rdy++;
                }
            }
            else if(c == "x")
            {
                let ec = "O";
                let eck = "o";
                //lewo góra
                let lgx = z1;
                let lgy = z2;
                while(lgx >= 0 && lgy >= 0)
                {
                    if(board[lgx][lgy] == ec || board[lgx][lgy] == eck)
                    {
                        if(lgx - 1 >= 0 && lgy - 1 >= 0)
                        if(board[lgx - 1][lgy - 1] == "")
                        {
                            while(lgx >= 0 && lgy >= 0)
                            {
                                var position = "" + lgx + lgy;
                                if(board[lgx][lgy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                lgx--;
                                lgy--;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    lgx--;
                    lgy--;
                }
                //lewo dół
                let ldx = z1;
                let ldy = z2;
                while(ldx >= 0 && ldy < 8)
                {
                    if(board[ldx][ldy] == ec || board[ldx][ldy] == eck)
                    {
                        if(ldx - 1 >= 0 && ldy + 1 < 8)
                        if(board[ldx - 1][ldy + 1] == "")
                        {
                            while(ldx >= 0 && ldy < 8)
                            {
                                var position = "" + ldx + ldy;
                                if(board[ldx][ldy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                ldx--;
                                ldy++;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    ldx--;
                    ldy++;
                }
                //prawo góra                
                let rgx = z1;
                let rgy = z2;
                while(rgx < 8 && rgy >= 0)
                {
                    if(board[rgx][rgy] == ec || board[rgx][rgy] == eck)
                    {
                        if(rgx + 1 < 8 && rgy - 1 >= 0)
                        if(board[rgx + 1][rgy - 1] == "")
                        {
                            while(rgx < 8 && rgy >= 0)
                            {
                                var position = "" + rgx + rgy;
                                if(board[rgx][rgy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                rgx++;
                                rgy--;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    rgx++;
                    rgy--;
                }
                //prawo dół                
                let rdx = z1;
                let rdy = z2;
                while(rdx < 8 && rdy < 8)
                {
                    if(board[rdx][rdy] == ec || board[rdx][rdy] == eck)
                    {
                        if(rdx + 1 < 8 && rdy + 1 < 8)
                        if(board[rdx + 1][rdy + 1] == "")
                        {
                            while(rdx < 8 && rdy < 8)
                            {
                                var position = "" + rdx + rdy;
                                if(board[rdx][rdy] == "")
                                {
                                    document.getElementById(position).setAttribute("style", style);
                                    document.getElementById(position).setAttribute("IsClicked",  p);
                                }
                                var pos = "" + z1 + z2;
                                rdx++;
                                rdy++;
                            }
                            //document.getElementById(pos).classList.add("Clicked");
                            r = true;
                            break;
                        }
                    }
                    rdx++;
                    rdy++;
                }
            }
            return r;
        } 
        function UpdateTurn()
        {
            var pTurn = document.getElementById("turn");
            if(turn % 2 == 0)
            {
                pTurn.textContent = "O";
            }
            else
            {
                pTurn.textContent = "X";
            }
            if(IsWin("o") && IsWin("O"))
            {
                alert("Wgrały X");
            }
            if(IsWin("x") && IsWin("X"))
            {
                alert("Wygaly O");
            }
        }
        function CanMove(x, y)
        {//dwa warunki nie tylko == "X" ale tez == "x"
            if(board[x][y] == "X")
            {
                let lx = x - 1;
                let ly = y + 1;
                let rx = x + 1;
                let ry = y + 1;
                if(lx >= 0 && ly < 8)
                    if(board[lx][ly] == "")
                        return true;
                if(rx < 8 && ry < 8)
                    if(board[rx][ry] == "")
                        return true;
                if(lx >= 0 && ly < 8)
                {
                    if(board[lx][ly] == "O")
                    {
                        let bx = lx - 1;
                        let by = ly + 1;
                        if(bx >= 0 && by < 8)
                            if(board[bx][by] == "")
                                return true;
                    }
                }
                if(rx < 8 && ry < 8)
                {
                    if(board[rx][ry] == "O")
                    {
                        let bx = rx + 1;
                        let by = ry + 1;
                        if(board[bx][by] == "O")
                            if(bx < 8 && by < 8)
                                return true;
                    }
                }
            }
            else if(board[x][y] == "O")
            {
                let lx = x - 1;
                let ly = y - 1;
                let rx = x + 1;
                let ry = y - 1;
                if(lx >= 0 && ly >= 0)
                    if(board[lx][ly] == "")
                        return true;
                if(rx < 8 && ry >= 0)
                    if(board[rx][ry] == "")
                        return true;
                if(lx >= 0 && ly >= 0)
                {
                    if(board[lx][ly] == "X")
                    {
                        let bx = lx - 1;
                        let by = ly - 1;
                        if(bx >= 0 && by >= 0)
                            if(board[bx][by] == "")
                                return true;
                    }
                }
                if(rx < 8 && ry >= 0)
                {
                    if(board[rx][ry] == "X")
                    {
                        let bx = rx + 1;
                        let by = ry - 1;
                        if(board[bx][by] == "X")
                            if(bx < 8 && by >= 0)
                                return true;
                    }
                }
            }
            else if(board[x][y] == "o" || board[x][y] == "x")
            {
                var nc = board[x][y];
                if(nc == "x")
                    nc = "O";
                else
                    nc = "X";
                //left down
                let ldx = x - 1;
                let ldy = y + 1;
                if(ldx >= 0 && ldy < 8)
                {
                    if(board[ldx][ldy] == nc)
                    {
                        let bx = ldx - 1;
                        let by = ldy + 1;
                        if(bx >= 0 && by < 8)
                            if(board[bx][by] == "")
                                return true;
                    }
                }
                //left up
                let lux = x - 1;
                let luy = y - 1;
                if(lux >= 0 && luy >= 0)
                {
                    if(board[lux][luy] == nc)
                    {
                        let bx = lux - 1;
                        let by = luy - 1;
                        if(bx >= 0 && by >= 0)
                            if(board[bx][by] == "")
                                return true;
                    }
                }
                //right down 
                let rdx = x + 1;
                let rdy = y + 1;
                if(rdx < 8 && rdy < 8)
                {
                    if(board[rdx][rdy] == nc)
                    {
                        let bx = rdx + 1;
                        let by = rdy + 1;
                        if(board[bx][by] == "O")
                            if(bx < 8 && by < 8)
                                return true;
                    }
                }
                //right up
                let rux = x + 1;
                let ruy = y - 1;
                if(rux < 8 && ruy >= 0)
                {
                    if(board[rux][ruy] == nc)
                    {
                        let bx = rux + 1;
                        let by = ruy - 1;
                        if(board[bx][by] == nc)
                            if(bx < 8 && by >= 0)
                                return true;
                    }
                }
                if(lux >= 0 && luy >= 0)
                    if(board[lux][luy] == "")
                        return true;
                if(rux < 8 && ruy >= 0)
                    if(board[rux][ruy] == "")
                        return true;
                if(ldx >= 0 && ldy < 8)
                    if(board[ldx][ldy] == "")
                        return true;
                if(rdx < 8 && rdy < 8)
                    if(board[rdx][rdy] == "")
                        return true;
            }
            return false;
        }
        function RemoveClicked()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    var pos = "" + o + i;
                    document.getElementById(pos).classList.remove("Clicked");
                }
            }
        }
        function IsWin(c)
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    if(board[o][i] == c)
                        if(CanMove(o, i))
                            return false;
                }
            }
            return true;
        }
        function LastRow()
        {
            for(let i=0;i<8;i++)
            {
                if(board[i][0] == "O")
                {
                    board[i][0] = "o";
                }
                if(board[i][7] == "X")
                {
                    board[i][7] = "x";
                }
            }
        }
   </script>
</body>
</html>
