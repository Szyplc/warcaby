<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<title>Warcaby</title>
</head>
<body>
    <style>
        table, tr, td
        {
            border: 2px solid black;
            border-collapse: collapse;
        }
        tr, td
        {
            width: 40px;
            height: 40px;
        }
        .white
        {
            background-color: white;
            color: black;
            text-align: center;
            font-weight: 700;
        }
        .black
        {
            background-color: black;
            color: white;
            text-align: center;
            font-weight: 700;
        }
        .turn
        {
            background-color: #000000;
            color: white;
            text-align: center;
            display: inline;
            position: absolute;
            font-size: 50px;
        }
        table
        {
            display: inline;
        }
        .Clicked
        {
            text-align: center;
            background-color: darkmagenta;
        }
    </style>
   <script>
       var wcb = "";
       var board = [[], [], [], [], [], [], [], []];
       var turn = 0;
        var table = document.createElement("table");
        var pTurn = document.createElement("p");
        var piecePosition = ['17', '37', '57', '77', '06', '26', '46', '66'];
        var blackPiecePosition = ['00', '20', '40', '60', '11', '31', '51', '71'];
        var style = "background: #00ff00;";
        Start();
        function Start()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    board[i].push("");
                }
            }
            for(let i=0;i<8;i++)
            {
                var tr = document.createElement("tr");
                for(let o=0;o<8;o++)
                {
                    var td = document.createElement("td");
                    id = o + "" + i;
                    td.setAttribute("id", id);
                    if((o+i) % 2 == 1)
                        td.setAttribute("class", "black");
                    else
                        td.setAttribute("class", "white");
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            document.body.appendChild(table);
            pTurn.id = "turn";
            pTurn.setAttribute("class", "turn");
            document.body.append(pTurn);
            setInterval(UpdateTurn, 500);
            piecePosition.forEach(function a(item, index)
            {
                var i1 = parseInt(item[0]);
                var i2 = parseInt(item[1]);
                board[i1][i2] = "O";
            })
            blackPiecePosition.forEach(function b(item, index)
            {
                var z1 = parseInt(item[0]);
                var z2 = parseInt(item[1]);
                board[z1][z2] = "X";
            })
            MakeBoard();
            document.addEventListener('click', OnClick);
        }
        function OnClick(e)
        {
            RemoveStyle();
            if(e.srcElement.id == '' || e.srcElement.id == "turn")
            {
                return 0;
            }
            var i1 = e.srcElement.id[0];
            var i2 = e.srcElement.id[1];
            // to ma isclicked jak nie to usun wszystkie is clicked
            if(e.srcElement.hasAttribute('isClicked'))
            {
                OnClickIsClicked(e.srcElement.id);
                LastRow();
                MakeBoard();
                RemoveIsClicked();
                RemoveStyle();
                turn++;
                return 0;
            }
           FirstClick(i1, i2, e.srcElement.id);
            
            e.srcElement.classList.add("Clicked");
        }
        function FirstClick(i1, i2, id)
        {
            var field = document.getElementById(id);
            if(board[i1][i2] == "O" && turn % 2 == 0)
            {//zmienia tez i1 i i2 jak przy klasach
                if(i2 < 1)
                {
                    return 0;
                }
                var l1 = parseInt(i1) - 1;
                var l2 = parseInt(i2) - 1;
                var r1 = parseInt(i1) + 1;
                var r2 = parseInt(i2) - 1;
                if(i1>0)//left
                {
                    
                    var left = "" + l1 + l2;
                    if(!document.getElementById(left).hasAttribute('style'))//usunac to raczej
                    {
                          RemoveStyle();
                        var z1 = left[0];
                        var z2 = left[1];//dac pierww kick off
                        if(board[z1][z2] == "X")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "O"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "O")//tu pozniej bez X bo bicie 
                        {
                            if(IsSomewhereKickedOf("O") == "")
                            {
                                document.getElementById(left).setAttribute("style", style);
                                document.getElementById(left).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }   
                        
                        
                    }
                }
                if(i1<7)//right
                {

                    var right = "" + r1 + r2;
                    if(!document.getElementById(right).hasAttribute('style'))
                    {
                        var z1 = right[0];
                        var z2 = right[1];
                        if(board[z1][z2] == "X")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "O"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "O")//tu pozniej bez X bo bicie
                        {
                            if(IsSomewhereKickedOf("O") == "")
                            {
                                document.getElementById(right).setAttribute("style", style);
                                document.getElementById(right).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }
                    }
                }
            }
            else
            if(board[i1][i2] == "X" && turn % 2 == 1)//zmienic i2 <1 itp
            {//zmienia tez i1 i i2 jak przy klasach
                if(i2 > 6)
                {
                    return 0;
                }
                var l1 = parseInt(i1) - 1;
                var l2 = parseInt(i2) + 1;
                var r1 = parseInt(i1) + 1;
                var r2 = parseInt(i2) + 1;
                if(i1>0)//left
                {
                    
                    var left = "" + l1 + l2;
                    if(!document.getElementById(left).hasAttribute('style'))//usunac to raczej
                    {
                          RemoveStyle();
                        var z1 = left[0];
                        var z2 = left[1];//dac pierww kick off
                        if(board[z1][z2] == "O")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "X"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "X")//tu pozniej bez X bo bicie 
                        {
                            if(IsSomewhereKickedOf("X") == "")
                            {
                                document.getElementById(left).setAttribute("style", style);
                                document.getElementById(left).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }   
                        
                        
                    }
                }
                if(i1<7)//right
                {

                    var right = "" + r1 + r2;
                    if(!document.getElementById(right).hasAttribute('style'))
                    {
                        var z1 = right[0];
                        var z2 = right[1];
                        if(board[z1][z2] == "O")//usunac mozliwosc nie bicia
                        {
                            if(IsKickOff(i1, i2, "X"))
                                return 0;
                        }
                        else
                        if(board[z1][z2] != "X")//tu pozniej bez X bo bicie
                        {
                            if(IsSomewhereKickedOf("X") == "")
                            {
                                document.getElementById(right).setAttribute("style", style);
                                document.getElementById(right).setAttribute("IsClicked", field.id);///////////////sprawdzic czy je
                            }
                        }
                    }
                }
            }
        }
        function OnClickIsClicked(id)
        {
            var field = document.getElementById(id);
            if(wcb != "")
                {
                    if(field.getAttribute("isClicked") != wcb)
                    {
                        alert("MASZ BICIE!!!");
                        return 0;
                    }
                }
                wcb = "";
                var id = field.id;
                var position = "" + document.getElementById(id).getAttribute('isClicked');
                //var position = e.srcElement.getAttribute('isClicked');//stad zabrac piona
                var d1 = field.id[0];
                var d2 = field.id[1]; 
                var n1 = position[0];
                var n2 = position[1];
                if(board[n1][n2] == "O")
                {
                    board[d1][d2] = "O";
                    board[n1][n2] = "";
                    var b1 = (parseInt(d1) + parseInt(n1)) / 2;
                    var b2 = (parseInt(d2) + parseInt(n2)) / 2;
                    if(b1 % 1 ==0 && b2 % 1 == 0)
                    {
                        if(board[b1][b2] == "X")
                        {
                            board[b1][b2] = "";
                            if(IsKickOff(d1, d2, "O"))
                            {
                                wcb = "" + d1 + d2;
                                turn--;
                            }
                        }
                    }
                }
                else
                {
                    board[d1][d2] = "X";
                    board[n1][n2] = "";
                    var b1 = (parseInt(d1) + parseInt(n1)) / 2;
                    var b2 = (parseInt(d2) + parseInt(n2)) / 2;
                    if(b1 % 1 ==0 && b2 % 1 == 0)
                    {
                        if(board[b1][b2] == "O")
                        {
                            board[b1][b2] = "";
                            if(IsKickOff(d1, d2, "X"))
                            {
                                wcb = "" + d1 + d2;
                                turn--;
                            }
                        }
                    }
                }
        }
        function IsSomewhereKickedOf(c)
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    if(board[o][i] == c)
                    {
                        if(IsKickOff(o, i, c))
                        {
                            var position = "" + o + i;
                            return position;
                        }
                    }
                }
            }
            return "";
        }
        function RemoveIsClicked()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    var position = "" + o + i;
                    document.getElementById(position).removeAttribute('isClicked');
                }
            }
        }
        function RemoveStyle()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    var position = "" + o + i;
                    document.getElementById(position).removeAttribute('style');
                    document.getElementById(position).classList.remove('Clicked');
                }
            }
        }
        function MakeBoard()
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    let position = "" + o + i;
                    if(board[o][i] == "O")
                    {
                        document.getElementById(position).textContent = "O";
                    }
                    else if(board[o][i] == "X")
                    {
                        document.getElementById(position).textContent = "X";
                    }
                    else if(board[o][i] == "o")
                    {
                        document.getElementById(position).textContent = "o";
                    }
                    else if(board[o][i] == "x")
                    {
                        document.getElementById(position).textContent = "x";
                    }
                    else
                    {
                        document.getElementById(position).textContent = "";
                    }
                }
            }
        }//moze blad jak 2 razy na to samo pole klikniesz bo usuwa is clicked
        function IsKickOff(z1, z2, c)
        {//gdy jestesmy 2 2 to nie mozna nic zroobic bo raczej jest ustawion eze tam nic nie mozna zrobic
           //w lewo przy prawym biciu
            if(c == "O")
            {
                var r = false;
                var p = "" + z1 + z2;
                var l1 = parseInt(z1) - 1;
                var l2 = parseInt(z2) - 1;
                var r1 = parseInt(z1) + 1;
                var r2 = parseInt(z2) - 1;
                if(z1 > 1)//lewo
                {
                    if(z2 > 1)
                    {
                       
                        //zabezpieczenia przed koncem planszy
                        if(board[l1][l2] == "X")
                        {
                            var b1 = l1 - 1;
                            var b2 = l2 - 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                RemoveStyle();
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
                //powinno wykasowac te ktore sa na mniejszej posycji od maksa zeby bic do konca
                if(z1 < 6)
                {
                    if(z2 > 1)
                    {
                        if(board[r1][r2] == "X")
                        {
                            var b1 = r1 + 1;
                            var b2 = r2 - 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                RemoveStyle();
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
            }
            else if(c == "X")
            {
                var r = false;
                var p = "" + z1 + z2;
                var l1 = parseInt(z1) - 1;
                var l2 = parseInt(z2) + 1;
                var r1 = parseInt(z1) + 1;
                var r2 = parseInt(z2) + 1;
                if(z1 > 1)//lewo
                {
                    if(z2 < 6)
                    {
                       
                        //zabezpieczenia przed koncem planszy
                        if(board[l1][l2] == "O")
                        {
                            var b1 = l1 - 1;
                            var b2 = l2 + 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                RemoveStyle();
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
                //powinno wykasowac te ktore sa na mniejszej posycji od maksa zeby bic do konca
                if(z1 < 6)
                {
                    if(z2 < 6)
                    {
                        if(board[r1][r2] == "O")
                        {
                            var b1 = r1 + 1;
                            var b2 = r2 + 1;
                            if(board[b1][b2] == "")
                            {
                                //to mozna na lewo raz
                                //IsKickOff(b1, b2, "O");
                                var position = "" + b1 + b2;
                                RemoveStyle();
                                document.getElementById(position).setAttribute("style", style);
                                document.getElementById(position).setAttribute("IsClicked",  p);
                                var pos = "" + z1 + z2;
                                //document.getElementById(pos).classList.add("Clicked");
                                r = true;
                            }
                        }
                    }
                }
            }
            return r;
        } 
        function UpdateTurn()
        {
            var pTurn = document.getElementById("turn");
            if(turn % 2 == 0)
            {
                pTurn.textContent = "O";
            }
            else
            {
                pTurn.textContent = "X";
            }
            if(!IsWin("X"))
                alert("WYGRALY O");
            if(!IsWin("O"))
                alert("WYGRALY X");
        }
        function CanMove(x, y)
        {
            if(board[x][y] == "X")
            {
                let lx = x - 1;
                let ly = y + 1;
                let rx = x + 1;
                let ry = y + 1;
                if(lx >= 0 && ly < 8)
                    if(board[lx][ly] == "")
                        return true;
                if(rx < 8 && ry < 8)
                    if(board[rx][ry] == "")
                        return true;
                if(lx >= 0 && ly < 8)
                {
                    if(board[lx][ly] == "O")
                    {
                        let bx = lx - 1;
                        let by = ly + 1;
                        if(bx >= 0 && by < 8)
                            if(board[bx][by] == "")
                                return true;
                    }
                }
                if(rx < 8 && ry < 8)
                {
                    if(board[rx][ry] == "O")
                    {
                        let bx = rx + 1;
                        let by = ry + 1;
                        if(board[bx][by] == "O")
                            if(bx < 8 && by < 8)
                                return true;
                    }
                }
            }
            else if(board[x][y] == "O")
            {
                let lx = x - 1;
                let ly = y - 1;
                let rx = x + 1;
                let ry = y - 1;
                if(lx >= 0 && ly >= 0)
                    if(board[lx][ly] == "")
                        return true;
                if(rx < 8 && ry >= 0)
                    if(board[rx][ry] == "")
                        return true;
                if(lx >= 0 && ly >= 0)
                {
                    if(board[lx][ly] == "X")
                    {
                        let bx = lx - 1;
                        let by = ly - 1;
                        if(bx >= 0 && by >= 0)
                            if(board[bx][by] == "")
                                return true;
                    }
                }
                if(rx < 8 && ry >= 0)
                {
                    if(board[rx][ry] == "X")
                    {
                        let bx = rx + 1;
                        let by = ry - 1;
                        if(board[bx][by] == "X")
                            if(bx < 8 && by >= 0)
                                return true;
                    }
                }
            }
            return false;
        }
        function IsWin(c)
        {
            for(let i=0;i<8;i++)
            {
                for(let o=0;o<8;o++)
                {
                    if(board[o][i] == c)
                        if(CanMove(o, i))
                            return true;
                }
            }
            return false;
        }
        function LastRow()
        {
            for(let i=0;i<8;i++)
            {
                if(board[i][0] == "O")
                {
                    board[i][0] = "o";
                }
                if(board[i][7] == "X")
                {
                    board[i][7] = "x";
                }
            }
        }
   </script>
</body>
</html>
